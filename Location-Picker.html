<html>
<head>
    <title>Location Picker (Google Maps)</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        #map {
            height: 500px;
            width: 100%;
            margin: 20px 0;
            border: 2px solid #ccc;
            border-radius: 8px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .coordinates-box {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .copy-button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        .copy-button:hover {
            background-color: #45a049;
        }
        .instructions {
            background-color: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .search-box {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="instructions">
            <h2>Location Picker</h2>
            <p>1. Search for a location or click on the map to select</p>
            <p>2. Copy the coordinates that appear below</p>
            <p>3. Paste the coordinates back into the main survey</p>
        </div>

        <input id="searchBox" class="search-box" type="text" placeholder="Search for a location...">
        <div id="map"></div>
        
        <div class="coordinates-box">
            <h3>Selected Location:</h3>
            <p id="coordinates">No location selected yet. Click on the map to select a location.</p>
            <button id="copyButton" class="copy-button" style="display: none;">Copy Coordinates</button>
        </div>
    </div>

    <script>
        let map;
        let marker;
        let searchBox;

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 2,
                center: { lat: 0, lng: 0 },
                mapTypeControl: true,
                mapTypeControlOptions: {
                    style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR,
                    position: google.maps.ControlPosition.TOP_RIGHT
                }
            });

            // Create search box
            const input = document.getElementById('searchBox');
            searchBox = new google.maps.places.SearchBox(input);
            map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

            // Bias search box results towards current map viewport
            map.addListener('bounds_changed', function() {
                searchBox.setBounds(map.getBounds());
            });

            // Listen for search box selections
            searchBox.addListener('places_changed', function() {
                const places = searchBox.getPlaces();
                if (places.length === 0) return;

                const place = places[0];
                if (!place.geometry) return;

                // Center map on selected place
                if (place.geometry.viewport) {
                    map.fitBounds(place.geometry.viewport);
                } else {
                    map.setCenter(place.geometry.location);
                    map.setZoom(17);
                }

                // Place marker
                placeMarker(place.geometry.location);
            });

            // Listen for map clicks
            map.addListener('click', function(e) {
                placeMarker(e.latLng);
            });

            // Try to get user's location
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    map.setCenter(pos);
                    map.setZoom(13);
                });
            }
        }

        function placeMarker(latLng) {
            if (marker) {
                marker.setMap(null);
            }
            marker = new google.maps.Marker({
                position: latLng,
                map: map
            });

            const lat = latLng.lat().toFixed(6);
            const lng = latLng.lng().toFixed(6);
            
            document.getElementById('coordinates').textContent = 
                `Latitude: ${lat}, Longitude: ${lng}`;
            document.getElementById('copyButton').style.display = 'block';
        }

        // Handle copy button
        document.getElementById('copyButton').addEventListener('click', function() {
            navigator.clipboard.writeText(
                document.getElementById('coordinates').textContent
            ).then(function() {
                alert('Coordinates copied to clipboard!');
            }).catch(function(err) {
                alert('Failed to copy coordinates. Please copy them manually.');
            });
        });
    </script>
    <!-- Replace YOUR_GOOGLE_MAPS_API_KEY with your actual API key -->
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&libraries=places&callback=initMap" async defer></script>
</body>
</html>